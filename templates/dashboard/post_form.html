{% extends 'base.html' %}

{% block title %}{{ action }} Post - KishorelinBlog{% endblock %}

{% block extra_css %}
<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs5.min.css" rel="stylesheet">
<style>
    .note-editor {
        border-radius: 10px;
        border: 2px solid var(--border-color);
    }
    
    .note-toolbar {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        border-radius: 10px 10px 0 0;
        padding: 0.5rem;
    }
    
    .note-editable {
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 400px;
        font-size: 1rem;
        line-height: 1.6;
        padding: 1rem;
    }
    
    .note-editable:focus {
        outline: none;
    }
    
    .note-toolbar .note-btn {
        border-color: var(--border-color);
        color: var(--text-color);
        background: var(--bg-color);
        border-radius: 6px;
        margin: 0 2px;
    }
    
    .note-toolbar .note-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    .note-toolbar .note-btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    /* Responsive editor */
    @media (max-width: 767.98px) {
        .note-editable {
            min-height: 300px;
            font-size: 16px; /* Prevents zoom on iOS */
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="fw-bold">
                    <i class="bi bi-pencil"></i> {{ action }} Post
                </h1>
                <a href="{% url 'post_list_admin' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Posts
                </a>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        {% if form.errors %}
                        <div class="alert alert-danger">
                            <strong>Please fix the following errors:</strong>
                            <ul class="mb-0">
                                {% for field, errors in form.errors.items %}
                                    {% for error in errors %}
                                        <li>{{ field|capfirst }}: {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="{{ form.title.id_for_label }}" class="form-label">Title *</label>
                            {{ form.title }}
                            {% if form.title.errors %}
                            <div class="text-danger">{{ form.title.errors }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.content.id_for_label }}" class="form-label">Content *</label>
                            <div class="alert alert-info mb-3">
                                <strong><i class="bi bi-info-circle"></i> Rich Text Editor:</strong>
                                <p class="mb-0 mt-2">Use the toolbar above to format your content. You can make text <strong>bold</strong>, <em>italic</em>, add lists, headings, links, and more - just like Microsoft Word!</p>
                            </div>
                            <div class="alert alert-warning mb-3">
                                <strong><i class="bi bi-code-slash"></i> For Code Blocks:</strong>
                                <p class="mb-0 mt-2">Click the <code>&lt;/&gt;</code> button in the toolbar to switch to HTML mode, then wrap code in: <code>&lt;pre&gt;&lt;code class="language-python"&gt;your code&lt;/code&gt;&lt;/pre&gt;</code></p>
                            </div>
                            {{ form.content }}
                            {% if form.content.errors %}
                            <div class="text-danger">{{ form.content.errors }}</div>
                            {% endif %}
                            <small class="form-text text-muted">
                                <i class="bi bi-lightbulb"></i> Tip: Use the formatting toolbar to style your content. For code blocks, switch to HTML mode using the <code>&lt;/&gt;</code> button.
                            </small>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.cover_image.id_for_label }}" class="form-label">Cover Image</label>
                                {% if post and post.cover_image %}
                                <div class="mb-2">
                                    <p class="text-muted small">Current image:</p>
                                    <img src="{{ post.cover_image.url }}" alt="Current cover" class="img-thumbnail" style="max-width: 200px;">
                                    <p class="text-muted small mt-2">Upload a new image to replace it, or leave empty to keep current image.</p>
                                </div>
                                {% endif %}
                                {{ form.cover_image }}
                                {% if form.cover_image.errors %}
                                <div class="text-danger">{{ form.cover_image.errors }}</div>
                                {% endif %}
                                <small class="form-text text-muted">Supported formats: JPG, PNG, GIF. Leave empty to keep existing image.</small>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="{{ form.category.id_for_label }}" class="form-label">Category</label>
                                {{ form.category }}
                                {% if form.category.errors %}
                                <div class="text-danger">{{ form.category.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.tags.id_for_label }}" class="form-label">Tags</label>
                            <small class="text-muted d-block mb-2">Hold Ctrl (or Cmd on Mac) to select multiple tags</small>
                            {{ form.tags }}
                            {% if form.tags.errors %}
                            <div class="text-danger">{{ form.tags.errors }}</div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.is_published }}
                                    <label class="form-check-label" for="{{ form.is_published.id_for_label }}">
                                        Publish immediately
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.is_featured }}
                                    <label class="form-check-label" for="{{ form.is_featured.id_for_label }}">
                                        Feature this post
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Save Post
                            </button>
                            {% if post %}
                            <a href="{% url 'post_delete' post.id %}" class="btn btn-outline-danger">
                                <i class="bi bi-trash"></i> Delete
                            </a>
                            {% endif %}
                            <a href="{% url 'post_list_admin' %}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Summernote JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs5.min.js"></script>

<script>
    $(document).ready(function() {
        // Initialize Summernote
        $('#id_content').summernote({
            height: 450,
            minHeight: 400,
            maxHeight: 800,
            focus: true,
            toolbar: [
                // Style
                ['style', ['style']],
                // Font
                ['font', ['bold', 'italic', 'underline', 'clear', 'strikethrough', 'superscript', 'subscript']],
                // Font Size
                ['fontsize', ['fontsize']],
                // Font Name
                ['fontname', ['fontname']],
                // Color
                ['color', ['color']],
                // Paragraph
                ['para', ['ul', 'ol', 'paragraph', 'height']],
                // Table
                ['table', ['table']],
                // Insert
                ['insert', ['link', 'picture', 'video', 'hr']],
                // View
                ['view', ['fullscreen', 'codeview', 'help']],
                // Undo/Redo
                ['undo', ['undo', 'redo']]
            ],
            fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', 'Tahoma', 'Times New Roman', 'Verdana', 'Georgia', 'Trebuchet MS'],
            fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '36', '48', '64'],
            placeholder: 'Start writing your blog post here... Use the toolbar above to format your content.',
            callbacks: {
                onInit: function() {
                    // Make sure content is properly loaded
                    var content = $('#id_content').val();
                    if (content) {
                        $('#id_content').summernote('code', content);
                    }
                },
                onChange: function(contents, $editable) {
                    // Update the textarea value
                    $('#id_content').val(contents);
                }
            },
            popover: {
                image: [
                    ['image', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],
                    ['float', ['floatLeft', 'floatRight', 'floatNone']],
                    ['remove', ['removeMedia']]
                ],
                link: [
                    ['link', ['linkDialogShow', 'unlink']]
                ],
                table: [
                    ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],
                    ['delete', ['deleteRow', 'deleteCol', 'deleteTable']]
                ]
            }
        });
    });
</script>
{% endblock %}

